/* eslint-disable prettier/prettier */
import axios from 'axios';
import Link from 'next/link';
import { useCallback, useEffect, useState } from 'react';

import { HeaderMenu } from 'features/HeaderMenu';
import { BurgerMenu } from 'shared/components/BurgerMenu';
import { Button } from 'shared/components/Button';
import { Logo } from 'shared/components/Logo';
import { links } from 'shared/constants';
import { handleExternalNavigation } from 'shared/utils';


import './header.scss';

const Header = () => {
  const [isMenuOpen, setIsMenuOpen] = useState(false);
  const [starCount, setStarCount] = useState(null);

  const handleToggleMenu = useCallback(() => {
    setIsMenuOpen((prev) => !prev);
  }, []);

  useEffect(() => {
    const onScroll = () => {
      let lastScroll = 0;
      const defaultOffset = 93;
      const header = document.querySelector('.header');

      const scrollPosition = () => window.pageYOffset || document.documentElement.scrollTop;
      const containHide = () => header?.classList.contains('hide');

      window.addEventListener('scroll', () => {
        if (scrollPosition() > lastScroll && !containHide() && scrollPosition() > defaultOffset) {
          header?.classList.toggle('hide', true);
        } else if (scrollPosition() < lastScroll && containHide()) {
          header?.classList.toggle('hide', false);
        }

        lastScroll = scrollPosition();
      });
    };

    onScroll();

    return () => window.removeEventListener('scroll', onScroll);
  }, []);

  useEffect(() => {
    if (isMenuOpen) document.body.classList.toggle('overflowed', true);
    if (!isMenuOpen) document.body.classList.toggle('overflowed', false);

    return () => {
      document.body.classList.toggle('overflowed', false);
    };
  }, [isMenuOpen]);


  useEffect(() => {
    const fetchStarCount = async () => {
      try {
        const response = await axios.get(`https://api.github.com/repos/SuperDuperDB/superduperdb`);
        const count = response.data.stargazers_count;
        setStarCount(count);
      } catch (error) {
        console.error('Error fetching star count:', error);
      }
    };

    fetchStarCount();
  }, []);

  const handleGitHubLinkClick = (event: any) => {
    const allowedTags = ['svg', 'path', 'span', 'a'];

    if (!allowedTags.includes(event.target.tagName.toLowerCase().trim())) {
      // Open the link in a new tab or window
      window.open('https://github.com/SuperDuperDB/superduperdb', '_blank');
    }
  };


  return (
    <>
      <header className="header">
        {/* <div className='pre_head' onClick={handleGitHubLinkClick} style={{ cursor: 'pointer' }}>
          <div className='git_star'>
            <a target='_blank' href='https://github.com/SuperDuperDB/superduperdb' style={{ textDecoration: 'none', color: 'black' }}>
              <div className='git_text'>
                <svg viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z"></path></svg> &nbsp;
                <span>Star us on Github!</span>
              </div>
            </a>
            <a target='_blank' href='https://github.com/SuperDuperDB/superduperdb' style={{ textDecoration: 'none', color: '#7628f8' }} className='git_number'>{starCount !== null ? starCount : 'Loading...'}</a>
          </div>
          <div>
            <a style={{ textDecoration: 'none', color: 'white', fontWeight: "900" }} target='_blank' href='https://github.com/SuperDuperDB/superduperdb' className='pre_head_text'><span >SuperDuperDB is open-source! Find us on GitHub! </span> ðŸ”®</a></div>
          <div className='web_icon'>
            <a className='socialIcons' target='_blank' href='https://www.youtube.com/channel/UC-clq9x8EGtQc6MHW0GF73g' style={{ marginRight: '10px', fontSize: '14px' }}><svg fill='white' xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 576 512"><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z" /></svg></a>
            <a className='socialIcons' target='_blank' style={{ marginRight: '10px', fontSize: '14px' }} href="https://twitter.com/superduperdb"> <svg fill='white' xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z" /></svg></a>
            <a className='socialIcons' target='_blank' style={{ marginLeft: '10px', fontSize: '14px' }} href="https://join.slack.com/t/superduperdb/shared_invite/zt-1zuojj0k0-RjAYBs1TDsvEa7yaFGa6QA"><svg fill='white' xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><path d="M94.12 315.1c0 25.9-21.16 47.06-47.06 47.06S0 341 0 315.1c0-25.9 21.16-47.06 47.06-47.06h47.06v47.06zm23.72 0c0-25.9 21.16-47.06 47.06-47.06s47.06 21.16 47.06 47.06v117.84c0 25.9-21.16 47.06-47.06 47.06s-47.06-21.16-47.06-47.06V315.1zm47.06-188.98c-25.9 0-47.06-21.16-47.06-47.06S139 32 164.9 32s47.06 21.16 47.06 47.06v47.06H164.9zm0 23.72c25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06H47.06C21.16 243.96 0 222.8 0 196.9s21.16-47.06 47.06-47.06H164.9zm188.98 47.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06h-47.06V196.9zm-23.72 0c0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06V79.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06V196.9zM283.1 385.88c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06v-47.06h47.06zm0-23.72c-25.9 0-47.06-21.16-47.06-47.06 0-25.9 21.16-47.06 47.06-47.06h117.84c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06H283.1z" /></svg></a></div>
        </div> */}

        <div className="header__container">
          <Logo />
          <HeaderMenu isOpen={isMenuOpen} />
          <BurgerMenu isOpen={isMenuOpen} onClick={handleToggleMenu} />
          <div className="header-get-started-btn">
            <Link href="join-beta-waitlist">
              <Button
                label="Join Waitlist"
                variant="outlined"
                fullWidth
              />
            </Link>
          </div>
        </div>
      </header>
    </>

  );
};

export default Header;
